<img width="574" height="324" alt="image" src="https://github.com/user-attachments/assets/3fbaeed7-78be-450c-ae86-073ed3a4626c" />

Os manipuladores de eventos geram eventos no FortiAnalyzer. O FortiAnalyzer já vem pré-configurado com diversos manipuladores de eventos predefinidos. No entanto, o FortiAnalyzer oferece aos analistas a possibilidade de criar seus personalizados para gerar eventos a partir de logs que considerem importantes. A assinatura do Serviço de Automação de Segurança fornece ao FortiAnalyzer manipuladores de eventos em tempo real que podem ajudar a detectar ataques de dia zero. 

O FortiAnalyzer filtra os registros recebidos usando manipuladores de eventos e, se os registros recebidos corresponderem às condições definidas nos manipuladores de eventos, o FortiAnalyzer gera um evento. Pode-se visualizar todos os eventos gerados na página Monitor de Eventos. 

<img width="1327" height="750" alt="image" src="https://github.com/user-attachments/assets/8729e8ad-4b12-4dd9-8a39-b5ebeb698a23" />

Depois de receber logs de outros dispositivos, e baseado nos detalhes incluindo eles, FortiAnalyzer utiliza manipuladores de eventos para determinar se novos eventos precisam ser gerados. Os manipuladores de eventos identificam se as informações nos registros correspondem a uma série de critérios configuráveis, como tipo de ameaça, tipo de dispositivo, tipo de registro e assim por diante. 

O FortiAnalyzer vem com vários manipuladores de eventos predefinidos que pode-se usar, clonar e personalizar. Pode-se também criar manipuladores de eventos personalizados do zero. 

Pode-se visualizar os eventos gerados no Monitor de Eventos, onde poderá vê-los combinados ou divididos por eventos de endpoint, ameaça e sistema. 

Se os eventos exigirem mais atenção e investigação, pode-se classifica-los como incidentes. A partir daí, pode-se correlacionar registros com um incidente, consultar a linha do tempo do incidente, atribuir uma prioridade e um analista para revisá-lo, entre outras ações. Para um grande volume de eventos gerados, pode-se utilizar playbooks para criar, gerenciar e resolver incidentes. 

O FortiAnalyzer pode extrair indicadores como endereços IP, domínios e URLs dos eventos gerados e enriquecê-los usando os serviços de enriquecimento do FortiGuard e do VírusTotal. 

<img width="606" height="344" alt="image" src="https://github.com/user-attachments/assets/fc4924a5-fddf-47a7-ae29-99d4d2c5f549" />

Um manipulador de evento olha para condições específicas nos logs e se a combinação existir, gera um evento com detalhes que pode-se configurar. O FortiAnalyzer inclui muitos manipuladores de eventos predefinidos que permite gerar eventos. 

Na imagem acima é mostrado um manipulador de eventos que tem 15 regras e gerou mais de 33 eventos no dispositivo FortiAnalyzer.

<img width="765" height="436" alt="image" src="https://github.com/user-attachments/assets/d024c043-e11a-432e-b756-c32e1be29e9e" />

Os manipuladores de evetnos requerem configuração de ajustes para fornecer apenas os eventos desejados. A página principal de configuração do manipulador de eventos permite habilitá-lo, atribuir um nome, escrever uma descrição e selecionar o tipo: básico ou de correlação. Quando o tipo de manipulador de eventos selecionado é correlação, um evento é gerado quando um conjunto de regras é atendido na sequência de correlação. 

Pode-se também escolher em qual domínio do MITRE o manipulador de eventos se enquadra e, em seguida, selecionar em uma lista de IDs de tecnologia que correspodem ao manipulador. Muitos manipuladores de eventos predefinidos já possuem os atributos MITRE configurados. Pode-se visualizar as matrizes da estrutura MITRE Att&ck em Incidentes e Eventos. 

Pode-se adicionar um seletor de dados, que é um filtro comum aplicado antes de cada regra configurada no manipulador de eventos. Por isso, eles também são conhecidos como filtros de excusão.

Quando um manipulador gera um evento com a opção de integração gera um evento com a opção de integração de automação ativada, o FortiAnalyzer envia uma notificação para a estrutura de automação do FortiGate, que então verifica se existe uma integração de automação correspondente no FortiOS. Se houver, a ação configurada é acionada. 

A seção Regras contém os campos que devem corresponder aos registros para gerar eventos. Você pode desativar, editar ou excluir regras para o manipulador. O tipo de manipulador básico usa lógica OR ao avaliar várias regras. O tipo de manipulador de correlação possui muito mais opções de lógica de operador. 

Pode-se selecionar um perfil de notificação para enviar alertas sempre que um evento for gerado pelo manipulador. 

<img width="1275" height="718" alt="image" src="https://github.com/user-attachments/assets/0fb7183d-6fae-4e3a-990c-397d600f4589" />

A imagem mostra os campos disponíveis para configuração dentro de uma regra., incluindo o tipo de dispositivo de log, o tipo de log e o subtipo de log. Observe que, dentro das próprias regras, as lógicas AND e OR são suportadas caso haja múltiplas condições. Você pode selecionar critérios comuns para incluir no filtro no Campo de Log. Alternativamente, pode-se usar filtros de texto genéricos se precisar de uma filtragem precisa. 

<img width="1265" height="713" alt="image" src="https://github.com/user-attachments/assets/2f91f6ea-6af4-400d-8199-4fafdfab7a09" />

Se um manipulador de evento está gerando muitos eventos no ambiente, pode-se configurar definições de expressões de agregação e duração da agregação.

A seção "Acionar um evento quando" contém três opções: 
* Pode-se definir um limite com base na contagem ou no número mínimo de registros correspondentes.
* Pode-se definir um limite com base em um campo específico, como um endereço IP de origem ou aplicativo distintos.
* Pode-se também definir um limite com base na duração, nos bytes enviados/recebidos e nos pacotes enviados/recebidos.

A duração é o limite mínimo em minutos para gerar eventos. As configurações de duração  e limite mínimo funcionam em conjunto. Para gerar um evento, o número mínimo de registros correspondentes (expressão) deve ocorrer no período de tempo especificado(duração). Pode-se também espeficicar o tipo de evento, a mensagem, o status e a gravidade dos eventos. 





