# Integração do Fabric
<img width="804" height="434" alt="image" src="https://github.com/user-attachments/assets/7f4e8cf3-5b8f-479f-8c9c-f25b799c02e7" />

O registro de logs e respostas opera de modo que:

1. Dispositivos registrados enviam dados de logs para o FortiAnalyzer.
2. FortiAnalyzer agrega e armazena os logs de maneira que faz com que seja fácil pesquisar e gerar reportes.
3. Administradores podem acessar FortiAnalyzer usando a GUI para manualmente visulizar os logs ou gerar reportes para analisar os dados. Eles podem também usar a CLI para tarefas administrativas.

FortiAnalyzer pode ser facilmente integrado na rede, mesmo em múltiplos provedores. Uma topologia típica pode incluir diversos filiais e uma sede. Cada firewal local é adicionado ao FortiAnalyzer, permitindo que o administrador visualize logs e gere reportes para toda a rede a partir de uma única interface. 

# Logs do Security Fabric

<img width="820" height="466" alt="image" src="https://github.com/user-attachments/assets/36e097d2-0665-40da-843e-7aa8ad8f650c" />

FortiAnalyzer suporta o Security Fabric armazenando e analisando os logs dos dispositivos dentro do grupo do Security Fabric como se eles se originassem de um único dispositivo. Ele correlaciona os registros de tráfego com os registros correspondentes do gerenciamento unificado de ameaças (UTM), permitindo gerar relatórios sobre sessões e largura de banda juntamente com seus eventos UTM.

Tráfego de logs para sessões de logins é sempre realizado pelo primeiro Fortigate que lida com Security Fabric. Dispositivos Fortigate sabem o mac dos seus peers upstream e downstream. Se o Fortigate recebe pacotes de um endereço MAC que pertence a outro Fortigate no Security Fabric, isso não gera um novo tráfego de logs para cada sessão. Essa abordagem ajuda a prevenir logs repetidos nas mesmas sessões por múltiplos dispositivos fortigate. 

Uma exceção para esse comportamento é que se o upstream do dispositivo Fortigate use NAT, então outro log é gerado. O log adicional é preciso para registrar os detalhes do NAT, como portas traduzidas e endereços. 

Quando configurados, os dispositivos upstream realizam o registro de logs do UTM, enquanto o FortiAnalyzer executa automaticamente a correlação dos logs de UTM e de tráfego para o Security Fabric. Esse processo garante um registro claro e preciso de quaisquer eventos de UTM que possam ocorrer, sem exigir configurações adicionais. 

Perceba que cada Fortigate no log do Security Fabric registra o tráfego para o FortiAnalyzer independemente do dispositivo raiz ou de outros dispositivos de borda. Se o Fortigate raiz estiver inativo, o registro de dados dos dispositivos Fortigate de borda para o FortiAnalyzer continua a operar normalmente. 

Em síntese, a integração entre o FortiAnalyzer e o Security Fabric garante uma estrutura de monitoramento altamente eficiente, centralizada e livre de redundâncias. Ao unificar e correlacionar logs de tráfego e eventos UTM como se todos os registros viessem de um único ponto, o FortiAnalyzer proporciona análises mais completas e precisas. O mecanismo inteligente de detecção entre os FortiGates evita duplicações de logs ao identificar sessões já registradas, exceto em cenários específicos envolvendo NAT, onde informações adicionais são indispensáveis. Além disso, a continuidade do envio de logs pelos dispositivos, mesmo na ausência do FortiGate raiz, reforça a resiliência do ambiente. Dessa forma, o Security Fabric, aliado ao FortiAnalyzer, oferece uma visão consistente, detalhada e confiável de toda a infraestrutura de segurança.

# Registro de Logs do Security Fabric
<img width="842" height="480" alt="image" src="https://github.com/user-attachments/assets/6852e589-fb48-4241-b62f-feeb6d7d4ebd" />

Ilustrando como funciona o registro de logs dentro do Security Fabric, assegurando total visibilidade enquanto elimina logs duplicados no ambiente. Três dispositivos Fortigate são configurados no Security Fabric juntamente do dispositivo FortiAnalyzer:
* Fortigate-A é instalado entre a rede corporativa e o ISP. Isso realiza a tradução do endereço de origem (SNAT) nas comunicações de saída para hosts RFC-1918 e aplica filtragem da web para sessões HTTP/HTTPS.
* Fortigate-B é instalado na camada de acesso, fornecendo detecção de dispositivos, isolamento de violações e proteção básica contra ataques de negação de serviços nas LANs dos usuários finais às quais está conectado.
* Fortigate-C é instalado no data center onde é executado o sistema de prevenção a intrusão para todas as comunicações de entrada de servidores por trás dele.

Todo o tráfego do cliente 1 é recebido primeiro pelo Fortigate-B que cria o log de tráfego para a sessãoo inicial. 

A sessão web é então encaminhada para o Fortigate-A, que não duplica o registro de tráfego inicial, mas gera um novo registro devido à aplicação do SNAT à sessão. Além disso, o Fortigate-A aplica uma política de filtragem web para esta sessão e gerar os registros UTM relevantes conforme necessário. 

A sessão SMB (Server Message Block) é encaminhada para o Fortigate-A, que, novamente, não duplica o registro de tráfego inicial. Como o Fortigate-A não precisa realizar NAT nem aplicar filtragem web, ele encaminha o tráfego para o Fortigate-C. O Fotigate-C também nao gera registro de tráfego duplicado, mas realiza a inspeção IPS de acordo com sua configuração. Se uma correspondência de assinatura for acionada e resultar em uma ação que gere registro, o evento será registrado. 

O FortiAnalyzer recebe os diversos registros de tráfego e UTM e os correlaciona automaticamente, garantindo que estejam vinculados para visualização, geração de relatórios e ações automatizadas adequadas. 

# FortiAnalyzer Fabric

<img width="847" height="479" alt="image" src="https://github.com/user-attachments/assets/293b30c7-b909-4a94-8092-6d69a0aa6cb1" />

O FortiAnalyzer Fabric possibilita monitoramento centralizado dos dispositivos, incidentes e eventos em múltiplos dispositivos FortiAnalyzer. Ele opera em dois modos: supervisor e membro.

O supervisor age como o dispositivo raiz no FortAnalyzer Fabric. Administradores de SOC podem usar o supervisor para visualizar dispositivos membros e seus ADOMs, registros de logs de dispositivos autorizados e eventos de incidentes gerados por membros. As informações de eventos e incidentes são sincronizadas dos membros para o supervisor através de uma API. 

Membros são dispositivos do FortiAnalyzer que enviam informações para o supervisor para monitoramento centralizado. Quando o dispositivo é configurado como um membro, ele retém acesso as funcionalidades descritas no Guia FortiAnalyzer Administration. Cada membro pode criar ou registrar incidentes e eventos. 

Dispositivos são configurados com alta disponibilidade podemagir como membros, mas, alta disponibilidade não é suportado pelos dispositivos do FortiAnalyze servindo como o Supervisor do Fabric. 

Todos os membros do FortiAnalyzer Fabric não tem que estar no mesmo fuso horário que supervisor. 

# Modo de Coleta do FortiAnalyzer

<img width="694" height="391" alt="image" src="https://github.com/user-attachments/assets/1b996b4d-706a-4d58-83c5-dc19704be70a" />

Quando está operando no modo coletor, o dispositivo coleta logs de múltiplos dispositivos e encaminha-os nos seus formatos originais em binário para outros dispositivos, como o FortiAnalyzer no modo analisador. Ele também envia os logs para o servidor syslog ou servidor CEF(Common Event Format), dependendo do modo de encaminhamento. Um coletor tem menos recursos comparado com o Analyzer, porque sua função primária é coletar e encaminhar logs. Ele não provê capacidade para gerenciar eventos ou reportar. 


