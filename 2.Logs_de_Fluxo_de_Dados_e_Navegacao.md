# Logs de Fluxo de Dados e Navegação
<img width="682" height="391" alt="image" src="https://github.com/user-attachments/assets/42eb4c96-2611-4a29-9c06-b093a3157f14" />

Mensagens de log ajudam a ter uma visão geral do que está acontecendo na rede. Pode-se usar os logs para diferentes propósitos. Por exemplo, usa-los para realizar troubleshoot na rede, determinar a carga nos dispositivos de rede, estabelecer baselines, monitorar uso de serviços, e dar suport à resposta a incidentes e à análise forense. 

Ele é importante para entender que logs são como quebra cabeças. Deve-se colocar muitas peças juntas para para ter um compreensão do que está acontecendo. Muitas vezes, é necessário revisar várias mensagens de log para determinar o elo exato de eventos e atividades que levaram a uma violação. Examinando um log isoladamente muitas vezes não ajuda a determinar o melhor caminho para configurar a rede para prevenir possíveis violações. Esse é o motivo da importância de ter um armazenamento de log centralizado.

# Regulações do Armazenamento de Logs

<img width="823" height="466" alt="image" src="https://github.com/user-attachments/assets/91cd6be1-e907-433b-9138-aec4dbbbcea3" />

As regulamentações exigem que as organizações registrem informações específicas, armazenam dados e os guardem no nível correto. É fundamental que seja entendida completamente a sua legislação que a organização deve cumprir, incluindo a jurisdição as quais ela pertence e se existem regulamentações específicas do setor que devem ser seguidas. Por exemplo, os setores financeiro e de saúde pode estar sujeitos a regulamentações adicionais, e certas informações privadas não podem ser registradas.

Você pode usar registros de atividades como prova em casos de atividades como prova em casos de atividades não autorizadas ou ilegais. Os dados utilizados como prova devem ser admissíveis em juízo, portanto, é fundamental que você seja capaz de compreender e analisar seus registros. 

Pode-se usar entradas de logs como evidências em casos de atividades ilegais ou não autorizadas. Os dados usados como evidência devem estar disponíveis em juízo, então é vital que sejamos capazes de entender e analizar logs. 

Estabelecendo política de segurança da organização pode ser difícil, particularmente se não existem políticas estabelecidas no local. Quando desenvolve-se políticas de segurança para a organizações, Fortinet recomenda consultar frameworks amplamente reconhecidos e padrões criados por organizações como a NIST e ISO.

# Analizando a Rede
<img width="853" height="488" alt="image" src="https://github.com/user-attachments/assets/0290e31d-127f-4d19-bd02-5b12b86e6c64" />

Para uma análise efetiva do tráfego da organização, é necessário um entendimento profundo da rede e ser capaz de identificar os seguintes:
* Infraestrutura crítica, como servidores e dispositivos de segurança. Esses dispositivos demandam o maior prioridade em qualquer análise.
* Tipos de tráfego esperado. Isso inclui cada protocolo que é permitido em cada dispositivo e ser capazz de identificar rapidamente um fluxo de tráfego anormal.
* Níveis de uso típicos picos. Estabelecendo linhas de base de rede para os níveis de tráfego em todos os horários ajudará você a reconhecer comportamentos inesperados, como um volume de tráfego acima do normal durante um determinado período.
* Fontes de picos de tráfego. Pode-se usar esses dados para criar uma reserva para janelas de manutenção previstas e backup de dados.

# Escopo do Registro de Logs

<img width="876" height="485" alt="image" src="https://github.com/user-attachments/assets/0c048b98-cf20-41ed-8be5-25ee8e6a4b7e" />

Dependendo do tamanho da sua organização, o tamanho dos dados de logs gerados podem ser muito pesados. Logs são geralmente gerados continuamente, e uma estação de trabalho pode gerar um grande volume de logs em um tempo curto. Como um analista, não é prático revisar todas as entradas e logs. Muitos logs são normais. Usando recursos para analisa-los não traz benefícios. 

Nem tudo em uma rede necessita ser registrado. Por exemplo, se o time de infraestrutura planeja conduzir testes em uma rede isolada, pode-se trabalhar com eles para disabilitar a rede de antemão. Dispositivos hospedados em uma rede restrita também não necessitam ser registrados.

Em cada análise, é importante priorizar fatores como tipos de tráfego, a origem do tráfego e destinos, e se existem eventos de segurança associados com esse tipo de tráfego. Além do mais, se o tráfego vem sendo enviado com frequência inesperada, seja maior ou menor do que esperado, uma investigação mais aprofundada se justifica. Saber quanto sua rede constuma gerar tráfego também pode ajudar a identificar comportamentos anômalos, como tráfego excessivo fora do horário comercial. 

# Fluxo de Trabalho de Arquivos de Log

<img width="867" height="477" alt="image" src="https://github.com/user-attachments/assets/435dba5b-187e-4b39-8001-f740dfa5a3a2" />

Quando dispositivos registrados enviam logs para o FortiAnalyzer, os logs seguem os seguintes fluxos de trabalho automático:

1. Logs recebidos são descompactados e salvos em um arquivo de log no disco do FortiAnalyzer. O arquivo de log tem a a extensão *.log*. Por exemplo, FortiAnalyze salva os logs do Fortigate com nomes de tlog.log e elog.log, para tráfego e logs de eventos.  

2. Ao mesmo tempo, o FortiAnalyzer indexa os logs salvos no banco de dados SQL para dar suporte as análises. Os logs são considerados online e oferecem suporte análitico imediato. O FortiAnalyzer exclui logs analíticos do banco de dados SQL conforme especificado na política de dados ADOM.

3. Quando o arquivo de log atinge um tamanho específico ou em um intervalo de tempo definido, ele é rotacionado. O processo de rotação de um arquivo de log consiste em renomeá-lo, adicionar um carimbo de data/hora e, em seguida, compactá-lo, o que adiciona a extensão .gz. Esses arquivos são conhecidos como logs arquivados e são considerados offline, portanto, não oferecem suporte analítico imediato. Em conjunto, os logs arquivados são contabilizados na cota de arquivamento e nos limites de retenção, e o FortiAnalyzer os exclui com base na política de dados ADOM.

# Normalizando Logs


<img width="767" height="430" alt="image" src="https://github.com/user-attachments/assets/b720b330-374a-4326-ae93-917994590ec0" />


FortiAnalyzer pode importar logs de várias origens. Para tornar fácil para analistas para visualizar e entender logs, FortiAnalyzer performa normalização de logs para mostrar campos de logs consistentes em todos os dispositivos de registro. Normalização de logs transforma entradas de log distintas em um formato padronizado e estruturado.

Quando o FortiAnalyzer importa logs, geralmente, eles estão em seu formato nativo e estruturado. Quando adiciona-se um dispositivo para o Fabric ADOM. FortiAnalyzer cria um banco de dados de informações de segurança e gerenciamento de eventos para que o ADOM, onde serão armazenados todos os logs normalizados.
FortiAnalyzer usa analisadores predefinidos para extrair campo-chaves de logs importados e os mapeia para um campo de nomes consistente e padronizado. Depois da análise e mapeamento, FortiAnalyzer importa e indexa as entradas de log dentro de um database de um SIEM.

Logs normalizado provêm uma visualização unificada e fornecem uma fácil correlação e uma investigação rápida. Por exemplo, com campos e valores padronizados, FortiAnalyzer pode correlacionar eventos de dispositivos diferentes, como bloqueio de tráfego no Fortigate e eventos de falha de logins no FortiAuthenticator. O campo de correlação de logs melhora a acuracidade de reporte e fornece o enriquecimento de dados de logs com contextos adicionaos como identidade de usuário ou dados de threat intellingence. 

O guia *Fabric Normalization Reference* provê uma lista de campos de correlações de logs entre FortiAnalyzer e dispositivos Fabric. 

# Analisando logs 

<img width="969" height="549" alt="image" src="https://github.com/user-attachments/assets/9cc8e77b-cbd7-43ea-abed-a8f7fcedacf6" />

Analizadores de log interpretam e transformam logs brutos, sem estrutura ou semi-estruturado em um formato estruturado e padronizado. Analizadores são o centro da normalização de logs. 

Analizadores sintáticos contêm conjuntos de regras e lógica predefinida que o FortiAnalyzer aplica aos dados de log recebidos. Pense nos analisadores como tradutores que convertem logs de dispositivos específicos ou fabricantes específicos em esquemas comuns no FortiAnalyzer. Os analisadores identificam e extraem campos-chave de messagens de log e as mapeia para nomes de campos padronizados. Algumas análises podem também padronizar valores de campos. Por exemplo, dispositivos diferentes podem usar "bloquear" e outros podem usar "negar". Em casos como esse, os analisadores sintátics podem converter os vários valores em um formato unificado bloqueado.

O FortiAnalyzer inclui analisadores integrados que analisam, normalizam e correlacionam logs de produtos Fortinet, bem como de aplicativos de terceiros. Por exemplo, existem analisadores de logs integrados para servidores web Apache e Nginx, e para os ogs integrados para servidores web Apache e Nginx, e para logs de eventos de segurança de hosts Windows e Linux (com integração ao Fabric Agent). Além disso, a licença do Security Automation Service oferece acesso a ainda mais analisadores de logs. 

# Validação de Logs usando o Analisadores de Logs

<img width="860" height="478" alt="image" src="https://github.com/user-attachments/assets/530d9d00-bb3d-41ae-964e-1c9a68daf44e" />

A função de validação de logs permite testar como uma análise específica vai processará uma entrada de log bruta. Isso é útil quando trabalha-se com logs de terceiros ou troubleshooting problemas de logs inesperados.

<img width="865" height="468" alt="image" src="https://github.com/user-attachments/assets/b4119051-3718-41ef-ada6-350ce09990c0" />

Na imagem acima temos um evento do Fortigate que foi normalizado pelo FortiAnalyzer usando o analisador de log do Fortigate. Quando muda-de a visualização para uma forma bruta, pode-se ver o campo comum de log do Fortigate, como data_sourceid, dst_ip, event_subtype, e event_policyid, foram convertidos para normalizar campos de logs. 

FortiAnlyzer normaliza os dados de todos os logs de dispositivos suportados que ele recebe. Normalização faz com que seja fácil para procurar e visualizar logs através de todos os dispositivos na rede. 

# Pesquisando usando campos normalizados

<img width="854" height="474" alt="image" src="https://github.com/user-attachments/assets/9e0c465c-85cc-4dd7-8aa6-10051e72ee4e" />

Pesquisar por logs usando campos normalizados é mais eficiente que vasculhar registros brutos e logs de dispositivos específicos. Logs de dispositivos nativos usam nomes de campos incosistentes e estruturas variadas, que fazem com que recuperações ou descobertas de parâmetos relevantes desafiem e consumam muito tempo. Quando o analisador do FortiAnalyzer padroniza e mapeia esses diversos campos em um formato unificado, pode-se executar queries consistentes e objetivas que agiliza as invetigações.



